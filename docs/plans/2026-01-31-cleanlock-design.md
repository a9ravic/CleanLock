# CleanLock è®¾è®¡æ–‡æ¡£

> macOS é”®ç›˜æ¸…æ´åŠ©æ‰‹ - é”å®šé”®ç›˜é˜²æ­¢è¯¯è§¦ï¼Œå¯è§†åŒ–æ¸…æ´è¿›åº¦

## æ¦‚è¿°

CleanLock æ˜¯ä¸€æ¬¾ macOS åŸç”Ÿåº”ç”¨ï¼Œç”¨äºæ¸…æ´ MacBook é”®ç›˜æ—¶é”å®šé”®ç›˜é˜²æ­¢è¯¯è§¦ã€‚åº”ç”¨æ˜¾ç¤ºé”®ç›˜å¸ƒå±€ï¼Œæ“¦æ‹­çš„æŒ‰é”®ä¼šäº®èµ·è¡¨ç¤º"å·²æ¸…æ´"ï¼Œå½“æ‰€æœ‰é”®éƒ½äº®èµ·åï¼Œ3 ç§’åè‡ªåŠ¨è§£é”ã€‚

**ç›®æ ‡ï¼š** ä¸Šæ¶ App Store

## æŠ€æœ¯é€‰å‹

- **UI æ¡†æ¶ï¼š** SwiftUI
- **ç³»ç»Ÿé›†æˆï¼š** AppKitï¼ˆèœå•æ ã€çª—å£ç®¡ç†ï¼‰
- **æŒ‰é”®æ‹¦æˆªï¼š** CoreGraphicsï¼ˆCGEvent tapï¼‰
- **çŠ¶æ€ç®¡ç†ï¼š** Combine
- **é¡¹ç›®ç®¡ç†ï¼š** XcodeGen
- **æœ€ä½ç³»ç»Ÿï¼š** macOS 13.0 (Ventura)

## é¡¹ç›®ç»“æ„

```
CleanLock/
â”œâ”€â”€ project.yml              # XcodeGen é…ç½®æ–‡ä»¶
â”œâ”€â”€ CleanLock/
â”‚   â”œâ”€â”€ App/
â”‚   â”‚   â”œâ”€â”€ CleanLockApp.swift
â”‚   â”‚   â”œâ”€â”€ AppDelegate.swift
â”‚   â”‚   â””â”€â”€ Info.plist
â”‚   â”œâ”€â”€ Views/
â”‚   â”‚   â”œâ”€â”€ MenuBarView.swift
â”‚   â”‚   â”œâ”€â”€ CleaningView.swift
â”‚   â”‚   â”œâ”€â”€ KeyboardView.swift
â”‚   â”‚   â”œâ”€â”€ KeyCapView.swift
â”‚   â”‚   â”œâ”€â”€ CompletionView.swift
â”‚   â”‚   â””â”€â”€ PermissionGuideView.swift
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ KeyboardLayout.swift
â”‚   â”‚   â””â”€â”€ CleaningState.swift
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ KeyInterceptor.swift
â”‚   â”‚   â”œâ”€â”€ HotKeyManager.swift
â”‚   â”‚   â””â”€â”€ PermissionManager.swift
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â””â”€â”€ Assets.xcassets
â”‚   â””â”€â”€ CleanLock.entitlements
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ plans/
â””â”€â”€ Makefile                 # ä¾¿æ·å‘½ä»¤
```

## XcodeGen é…ç½®

```yaml
name: CleanLock
options:
  bundleIdPrefix: com.zone
  deploymentTarget:
    macOS: "13.0"

targets:
  CleanLock:
    type: application
    platform: macOS
    sources: [CleanLock]
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.zone.cleanlock
        MACOSX_DEPLOYMENT_TARGET: "13.0"
        INFOPLIST_FILE: CleanLock/App/Info.plist
        CODE_SIGN_ENTITLEMENTS: CleanLock/CleanLock.entitlements
        ENABLE_HARDENED_RUNTIME: YES
    entitlements:
      path: CleanLock/CleanLock.entitlements
      properties:
        com.apple.security.app-sandbox: true
        com.apple.security.accessibility: true
```

## æ ¸å¿ƒæµç¨‹

### çŠ¶æ€æµè½¬

```
[å¾…æœº] â†’ ç”¨æˆ·è§¦å‘ â†’ [æƒé™æ£€æŸ¥] â†’ [æ¸…æ´æ¨¡å¼] â†’ [å®ŒæˆåŠ¨ç”»] â†’ [å¾…æœº]
                         â†“
                    [æƒé™å¼•å¯¼é¡µ]
```

### æ¸…æ´çŠ¶æ€å®šä¹‰

```swift
enum CleaningState {
    case idle                    // å¾…æœº
    case cleaning(Set<KeyCode>)  // æ¸…æ´ä¸­ï¼Œè®°å½•å·²æ¸…æ´çš„é”®
    case completed               // å…¨éƒ¨å®Œæˆï¼Œ3ç§’å€’è®¡æ—¶
    case exiting                 // é€€å‡ºåŠ¨ç”»ä¸­
}
```

### ç”¨æˆ·æ“ä½œæµç¨‹

1. **å¯åŠ¨æ¸…æ´æ¨¡å¼**ï¼šç‚¹å‡»èœå•æ å›¾æ ‡ æˆ– æŒ‰å…¨å±€å¿«æ·é”®ï¼ˆé»˜è®¤ `âŒ˜â‡§K`ï¼‰
2. **é¦–æ¬¡ä½¿ç”¨**ï¼šæ£€æµ‹åˆ°æ— æƒé™ â†’ æ˜¾ç¤ºå¼•å¯¼é¡µ â†’ å¼•å¯¼ç”¨æˆ·å»ç³»ç»Ÿè®¾ç½®æˆæƒ
3. **è¿›å…¥æ¸…æ´**ï¼šå…¨å±æ˜¾ç¤ºé”®ç›˜ï¼Œæ‰€æœ‰é”®å¸½æš—è‰²
4. **æ“¦æ‹­è¿‡ç¨‹**ï¼šæ¯æŒ‰ä¸‹ä¸€ä¸ªé”® â†’ è¯¥é”®äº®èµ· â†’ æŒ‰é”®è¢«æ‹¦æˆªä¸ä¼ é€’
5. **ä¸­é€”é€€å‡º**ï¼šé•¿æŒ‰ `Esc` 3 ç§’ æˆ– ç‚¹å‡»ç•Œé¢å³ä¸Šè§’é€€å‡ºæŒ‰é’®
6. **å…¨éƒ¨å®Œæˆ**ï¼šæ‰€æœ‰é”®äº®èµ· â†’ æ˜¾ç¤º"æ¸…æ´å®Œæˆ âœ“" â†’ 3 ç§’åæ·¡å‡ºé€€å‡º

## é”®ç›˜å¸ƒå±€

### MacBook å†…ç½®é”®ç›˜ï¼ˆ78 é”®ï¼‰

```
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
â”‚escâ”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 7 â”‚ 8 â”‚ 9 â”‚ 0 â”‚ - â”‚ = â”‚ deleteâ”‚
â”œâ”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”€â”€â”¤
â”‚ tab â”‚ Q â”‚ W â”‚ E â”‚ R â”‚ T â”‚ Y â”‚ U â”‚ I â”‚ O â”‚ P â”‚ [ â”‚ ] â”‚  \  â”‚
â”œâ”€â”€â”€â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”¤
â”‚ caps â”‚ A â”‚ S â”‚ D â”‚ F â”‚ G â”‚ H â”‚ J â”‚ K â”‚ L â”‚ ; â”‚ ' â”‚ return â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ shift  â”‚ Z â”‚ X â”‚ C â”‚ V â”‚ B â”‚ N â”‚ M â”‚ , â”‚ . â”‚ / â”‚   shift  â”‚
â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ fn  â”‚ctrlâ”‚ optâ”‚ cmd â”‚     space     â”‚cmd â”‚optâ”‚  arrows  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## UI è®¾è®¡

### macOS åŸç”Ÿè§†è§‰è§„èŒƒ

**é¢œè‰²ä½¿ç”¨ç³»ç»Ÿè¯­ä¹‰è‰²ï¼š**

```swift
Color.primary              // ä¸»æ–‡å­—
Color.secondary            // æ¬¡è¦æ–‡å­—
Color.accentColor          // å¼ºè°ƒè‰²ï¼ˆè·Ÿéšç”¨æˆ·ç³»ç»Ÿè®¾ç½®ï¼‰
Color(nsColor: .windowBackgroundColor)  // çª—å£èƒŒæ™¯
Color(nsColor: .controlBackgroundColor) // é”®å¸½èƒŒæ™¯
```

**é”®å¸½çŠ¶æ€ï¼š**

| çŠ¶æ€ | é¢œè‰² |
|------|------|
| æœªæ¸…æ´ | `Color(nsColor: .controlBackgroundColor)` |
| å·²æ¸…æ´ | `Color.accentColor` |

**åŸç”Ÿç»„ä»¶ï¼š**

- **å­—ä½“**ï¼š`.system()` ç³»ç»Ÿå­—ä½“ (SF Pro)
- **å›¾æ ‡**ï¼šSF Symbols
- **èƒŒæ™¯**ï¼š`.ultraThinMaterial` æ¯›ç»ç’ƒæè´¨
- **åŠ¨ç”»**ï¼š`.spring()` ç³»ç»Ÿå¼¹ç°§åŠ¨ç”»
- **åœ†è§’**ï¼š`.continuous` è¿ç»­æ›²ç‡åœ†è§’

### å…¨å±ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                            [é€€å‡ºæŒ‰é’®]  â”‚
â”‚                                                         â”‚
â”‚                      CleanLock                          â”‚
â”‚                 "æ“¦æ‹­é”®ç›˜ï¼ŒæŒ‰ä¸‹çš„é”®ä¼šäº®èµ·"               â”‚
â”‚                    è¿›åº¦: 45/78 é”®                        â”‚
â”‚                                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚              â”‚      é”®ç›˜å¸ƒå±€è§†å›¾        â”‚                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                         â”‚
â”‚                 é•¿æŒ‰ Esc 3ç§’å¯é€€å‡º                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çª—å£æ ·å¼

```swift
window.styleMask = [.borderless, .fullSizeContentView]
window.level = .screenSaver
window.backgroundColor = .clear
window.isOpaque = false
```

## æƒé™ç®¡ç†

### è¾…åŠ©åŠŸèƒ½æƒé™

```swift
// æ£€æµ‹æƒé™
func checkAccessibilityPermission() -> Bool {
    AXIsProcessTrusted()
}

// æ‰“å¼€ç³»ç»Ÿè®¾ç½®
func openAccessibilitySettings() {
    let url = URL(string: "x-apple.systempreferences:com.apple.preference.security?Privacy_Accessibility")!
    NSWorkspace.shared.open(url)
}
```

### æƒé™å¼•å¯¼é¡µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚    ğŸ” (SF Symbol: lock.shield)      â”‚
â”‚                                     â”‚
â”‚    CleanLock éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™        â”‚
â”‚                                     â”‚
â”‚    ä¸ºäº†æ‹¦æˆªé”®ç›˜è¾“å…¥é˜²æ­¢æ¸…æ´æ—¶è¯¯è§¦ï¼Œ   â”‚
â”‚    è¯·åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æˆäºˆè¾…åŠ©åŠŸèƒ½æƒé™ã€‚   â”‚
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚     æ‰“å¼€ç³»ç»Ÿè®¾ç½®...      â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”‚              ç¨åå†è¯´                â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Info.plist é…ç½®

```xml
<key>NSAccessibilityUsageDescription</key>
<string>CleanLock éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™æ¥æ‹¦æˆªé”®ç›˜è¾“å…¥ï¼Œé˜²æ­¢æ¸…æ´é”®ç›˜æ—¶è¯¯è§¦ã€‚</string>
```

## èœå•æ 

### å›¾æ ‡

- SF Symbolï¼š`keyboard.fill`
- 16x16 pt æ¨¡æ¿å›¾æ ‡

### èœå•è§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CleanLock                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¶ å¼€å§‹æ¸…æ´        âŒ˜â‡§K    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ“ å¼€æœºå¯åŠ¨               â”‚
â”‚    å¿«æ·é”®è®¾ç½®...           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…³äº CleanLock           â”‚
â”‚  é€€å‡º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…¨å±€å¿«æ·é”®

- é»˜è®¤ï¼š`âŒ˜â‡§K`
- å¯è‡ªå®šä¹‰ï¼Œå­˜å‚¨åœ¨ UserDefaults
- ä½¿ç”¨ `NSEvent.addGlobalMonitorForEvents` æ³¨å†Œ

## å®ŒæˆåŠ¨ç”»

### åŠ¨ç”»åºåˆ—

```
æ‰€æœ‰é”®äº®èµ· â†’ é”®ç›˜æ•´ä½“å‘å…‰è„‰å†² â†’ æ˜¾ç¤º"æ¸…æ´å®Œæˆ âœ“" â†’ 3ç§’å€’è®¡æ—¶ â†’ æ·¡å‡ºé€€å‡º
   0s            0.3s               0.5s            0.5-3.5s      3.5-4s
```

### å®Œæˆè§†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚           âœ“ (å¤§å·ï¼Œå¸¦ç¼©æ”¾å¼¹å…¥åŠ¨ç”»)        â”‚
â”‚                                         â”‚
â”‚             æ¸…æ´å®Œæˆï¼                   â”‚
â”‚                                         â”‚
â”‚          å³å°†é€€å‡º...  (3)                â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸­é€”é€€å‡º

| æ–¹å¼ | è¡Œä¸º |
|------|------|
| é•¿æŒ‰ Esc 3 ç§’ | æ˜¾ç¤ºç¯å½¢è¿›åº¦æ¡ï¼Œ3 ç§’åé€€å‡º |
| ç‚¹å‡»é€€å‡ºæŒ‰é’® | ç›´æ¥æ·¡å‡ºé€€å‡º |

## App Store ä¸Šæ¶

### åº”ç”¨ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| åº”ç”¨åç§° | CleanLock |
| Bundle ID | com.zone.cleanlock |
| åˆ†ç±» | å·¥å…· (Utilities) |
| æœ€ä½ç³»ç»Ÿ | macOS 13.0 |

### åº”ç”¨å›¾æ ‡

- ä¸»å…ƒç´ ï¼šé”®ç›˜ + é”/ç›¾ç‰Œ
- é£æ ¼ï¼šmacOS Big Sur é£æ ¼ï¼Œåœ†è§’çŸ©å½¢
- é¢œè‰²ï¼šè“è‰²ç³»

### æˆªå›¾éœ€æ±‚

1. æ¸…æ´æ¨¡å¼ä¸»ç•Œé¢
2. æƒé™å¼•å¯¼é¡µ
3. èœå•æ è§†å›¾
4. å®ŒæˆçŠ¶æ€

### App Store æè¿°

> **CleanLock - é”®ç›˜æ¸…æ´åŠ©æ‰‹**
>
> æ¸…æ´ MacBook é”®ç›˜æ—¶ï¼Œé”å®šé”®ç›˜é˜²æ­¢è¯¯è§¦ã€‚
>
> åŠŸèƒ½ç‰¹ç‚¹ï¼š
> â€¢ ä¸€é”®é”å®šé”®ç›˜ï¼Œå®‰å¿ƒæ“¦æ‹­
> â€¢ å¯è§†åŒ–æ˜¾ç¤ºæ¸…æ´è¿›åº¦ï¼Œæ“¦è¿‡çš„é”®ä¼šäº®èµ·
> â€¢ å…¨éƒ¨æ¸…æ´å®Œæˆåè‡ªåŠ¨è§£é”
> â€¢ å¸¸é©»èœå•æ ï¼Œå¿«æ·é”®éšæ—¶å¯åŠ¨
>
> éœ€è¦è¾…åŠ©åŠŸèƒ½æƒé™ä»¥æ‹¦æˆªé”®ç›˜è¾“å…¥ã€‚

### éšç§æ”¿ç­–

- æ— ç½‘ç»œè¯·æ±‚ï¼Œæ— æ•°æ®æ”¶é›†
- éœ€å‡†å¤‡éšç§æ”¿ç­–é¡µé¢
